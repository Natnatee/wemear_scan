<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebAR 360¬∞ ‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      #video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      #canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
      #info {
        position: absolute;
        top: 20px;
        left: 20px;
        color: white;
        background: rgba(0, 0, 0, 0.7);
        padding: 15px;
        border-radius: 8px;
        font-size: 14px;
        z-index: 10;
        max-width: 250px;
      }
      #startBtn {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 20px 40px;
        font-size: 18px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        z-index: 20;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      }
      #startBtn:hover {
        background: #45a049;
      }
      .color-legend {
        margin-top: 10px;
        font-size: 12px;
      }
      .color-item {
        display: flex;
        align-items: center;
        margin: 3px 0;
      }
      .color-box {
        width: 15px;
        height: 15px;
        border-radius: 3px;
        margin-right: 8px;
      }
    </style>
  </head>
  <body>
    <button id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏° AR 360¬∞</button>
    <video id="video" autoplay playsinline></video>
    <div id="info">
      <div>üéØ WebAR 360¬∞ - ‡∏´‡∏°‡∏∏‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏î‡∏π‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß</div>
      <div class="color-legend">
        <div class="color-item">
          <div class="color-box" style="background: #ff6b6b"></div>
          ‡∏´‡∏ô‡πâ‡∏≤ (‡πÅ‡∏î‡∏á)
        </div>
        <div class="color-item">
          <div class="color-box" style="background: #4ecdc4"></div>
          ‡∏´‡∏•‡∏±‡∏á (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô)
        </div>
        <div class="color-item">
          <div class="color-box" style="background: #ffe66d"></div>
          ‡∏ã‡πâ‡∏≤‡∏¢ (‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á)
        </div>
        <div class="color-item">
          <div class="color-box" style="background: #a8e6cf"></div>
          ‡∏Ç‡∏ß‡∏≤ (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô)
        </div>
        <div class="color-item">
          <div class="color-box" style="background: #ff8b94"></div>
          ‡∏ö‡∏ô (‡∏ä‡∏°‡∏û‡∏π)
        </div>
        <div class="color-item">
          <div class="color-box" style="background: #c7ceea"></div>
          ‡∏•‡πà‡∏≤‡∏á (‡∏°‡πà‡∏ß‡∏á‡∏≠‡πà‡∏≠‡∏ô)
        </div>
      </div>
    </div>

    <script>
      let scene, camera, renderer;
      let spheres = [];
      let video;

      // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏à‡πÇ‡∏£‡∏™‡πÇ‡∏Ñ‡∏õ
      const zee = new THREE.Vector3(0, 0, 1);
      const euler = new THREE.Euler();
      const q0 = new THREE.Quaternion();
      const q1 = new THREE.Quaternion(-Math.sqrt(0.5), 0, 0, Math.sqrt(0.5)); // -90 degrees around X
      let screenOrientation = window.orientation || 0;

      document.getElementById("startBtn").addEventListener("click", startAR);

      async function startAR() {
        document.getElementById("startBtn").style.display = "none";

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á
        video = document.getElementById("video");
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: {
              facingMode: "environment",
              width: { ideal: 1280 },
              height: { ideal: 720 },
            },
          });
          video.srcObject = stream;
        } catch (err) {
          alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: " + err.message);
          return;
        }

        // ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏ä‡πâ‡πÑ‡∏à‡πÇ‡∏£‡∏™‡πÇ‡∏Ñ‡∏õ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö iOS)
        if (
          typeof DeviceOrientationEvent !== "undefined" &&
          typeof DeviceOrientationEvent.requestPermission === "function"
        ) {
          try {
            const permission = await DeviceOrientationEvent.requestPermission();
            if (permission === "granted") {
              window.addEventListener(
                "deviceorientation",
                handleOrientation,
                true
              );
            }
          } catch (err) {
            alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏à‡πÇ‡∏£‡∏™‡πÇ‡∏Ñ‡∏õ‡πÑ‡∏î‡πâ");
          }
        } else {
          window.addEventListener("deviceorientation", handleOrientation, true);
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
        window.addEventListener("orientationchange", handleScreenOrientation);

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Three.js scene
        scene = new THREE.Scene();

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á
        camera = new THREE.PerspectiveCamera(
          75,
          window.innerWidth / window.innerHeight,
          0.1,
          1000
        );
        camera.position.set(0, 0, 0);

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á renderer
        renderer = new THREE.WebGLRenderer({
          alpha: true,
          antialias: true,
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.domElement.id = "canvas";
        document.body.appendChild(renderer.domElement);

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß - 6 ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á
        const distance = 4;
        const sphereSize = 0.4;

        const positions = [
          { pos: [0, 0, -distance], color: 0xff6b6b, name: "‡∏´‡∏ô‡πâ‡∏≤" },
          { pos: [0, 0, distance], color: 0x4ecdc4, name: "‡∏´‡∏•‡∏±‡∏á" },
          { pos: [-distance, 0, 0], color: 0xffe66d, name: "‡∏ã‡πâ‡∏≤‡∏¢" },
          { pos: [distance, 0, 0], color: 0xa8e6cf, name: "‡∏Ç‡∏ß‡∏≤" },
          { pos: [0, distance, 0], color: 0xff8b94, name: "‡∏ö‡∏ô" },
          { pos: [0, -distance, 0], color: 0xc7ceea, name: "‡∏•‡πà‡∏≤‡∏á" },
        ];

        positions.forEach((item) => {
          const geometry = new THREE.SphereGeometry(sphereSize, 32, 32);
          const material = new THREE.MeshStandardMaterial({
            color: item.color,
            metalness: 0.3,
            roughness: 0.4,
            emissive: item.color,
            emissiveIntensity: 0.2,
          });
          const sphere = new THREE.Mesh(geometry, material);
          sphere.position.set(...item.pos);
          sphere.userData.name = item.name;
          scene.add(sphere);
          spheres.push(sphere);
        });

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏á
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
        window.addEventListener("resize", onWindowResize);

        // ‡πÄ‡∏£‡∏¥‡πà‡∏° animation loop
        animate();
      }

      function handleScreenOrientation() {
        screenOrientation = window.orientation || 0;
      }

      function handleOrientation(event) {
        if (!event.alpha) return;

        // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏à‡πÇ‡∏£‡πÄ‡∏õ‡πá‡∏ô Quaternion ‡πÅ‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
        const alpha = THREE.MathUtils.degToRad(event.alpha);
        const beta = THREE.MathUtils.degToRad(event.beta);
        const gamma = THREE.MathUtils.degToRad(event.gamma);
        const orient = THREE.MathUtils.degToRad(screenOrientation);

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Euler angles ‡∏î‡πâ‡∏ß‡∏¢‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
        euler.set(beta, alpha, -gamma, "YXZ");

        // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Quaternion
        camera.quaternion.setFromEuler(euler);

        // ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏° screen orientation
        camera.quaternion.multiply(q1);
        camera.quaternion.multiply(q0.setFromAxisAngle(zee, -orient));
      }

      function animate() {
        requestAnimationFrame(animate);

        // ‡∏´‡∏°‡∏∏‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏°‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°
        spheres.forEach((sphere) => {
          sphere.rotation.x += 0.01;
          sphere.rotation.y += 0.01;
        });

        renderer.render(scene, camera);
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }
    </script>
  </body>
</html>
