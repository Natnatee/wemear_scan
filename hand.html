<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hand Detection - ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏°‡∏∑‡∏≠</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 900px;
        width: 100%;
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 10px;
        font-size: 2em;
      }

      .subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 20px;
        font-size: 0.9em;
      }

      .video-container {
        position: relative;
        width: 100%;
        max-width: 640px;
        margin: 0 auto;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      #videoElement {
        width: 100%;
        height: auto;
        display: block;
        transform: scaleX(-1);
      }

      #canvasElement {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform: scaleX(-1);
      }

      .status {
        text-align: center;
        margin-top: 20px;
        padding: 15px;
        background: #f0f0f0;
        border-radius: 10px;
        font-size: 1em;
      }

      .status.active {
        background: #d4edda;
        color: #155724;
      }

      .status.inactive {
        background: #f8d7da;
        color: #721c24;
      }

      .loading {
        text-align: center;
        color: #667eea;
        font-size: 1.2em;
        margin-top: 20px;
      }

      .info {
        margin-top: 20px;
        padding: 15px;
        background: #e7f3ff;
        border-left: 4px solid #2196f3;
        border-radius: 5px;
        font-size: 0.9em;
        color: #333;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üñêÔ∏è Hand Detection</h1>
      <p class="subtitle">‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ö‡∏ô‡∏°‡∏∑‡∏≠</p>

      <div class="video-container">
        <video id="videoElement" autoplay playsinline></video>
        <canvas id="canvasElement"></canvas>
      </div>

      <div id="status" class="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö...</div>

      <div class="info">
        üí°
        <strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡∏¢‡∏Å‡∏°‡∏∑‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡∏°‡∏∑‡∏≠
      </div>
    </div>

    <script>
      const videoElement = document.getElementById("videoElement");
      const canvasElement = document.getElementById("canvasElement");
      const canvasCtx = canvasElement.getContext("2d");
      const statusElement = document.getElementById("status");

      // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ MediaPipe Hands
      const hands = new Hands({
        locateFile: (file) => {
          return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
        },
      });

      hands.setOptions({
        maxNumHands: 2,
        modelComplexity: 1,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5,
      });

      hands.onResults(onResults);

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
      function drawConnectors(ctx, landmarks, connections, style) {
        connections.forEach((connection) => {
          const start = landmarks[connection[0]];
          const end = landmarks[connection[1]];

          ctx.beginPath();
          ctx.moveTo(
            start.x * canvasElement.width,
            start.y * canvasElement.height
          );
          ctx.lineTo(end.x * canvasElement.width, end.y * canvasElement.height);
          ctx.strokeStyle = style.color;
          ctx.lineWidth = style.lineWidth;
          ctx.stroke();
        });
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏≤‡∏î‡∏à‡∏∏‡∏î
      function drawLandmarks(ctx, landmarks, style) {
        landmarks.forEach((landmark) => {
          ctx.beginPath();
          ctx.arc(
            landmark.x * canvasElement.width,
            landmark.y * canvasElement.height,
            style.radius,
            0,
            2 * Math.PI
          );
          ctx.fillStyle = style.color;
          ctx.fill();
          ctx.strokeStyle = style.lineColor || "#ffffff";
          ctx.lineWidth = 2;
          ctx.stroke();
        });
      }

      // ‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏°‡∏∑‡∏≠
      const HAND_CONNECTIONS = [
        [0, 1],
        [1, 2],
        [2, 3],
        [3, 4], // ‡∏ô‡∏¥‡πâ‡∏ß‡∏´‡∏±‡∏ß‡πÅ‡∏°‡πà‡∏°‡∏∑‡∏≠
        [0, 5],
        [5, 6],
        [6, 7],
        [7, 8], // ‡∏ô‡∏¥‡πâ‡∏ß‡∏ä‡∏µ‡πâ
        [0, 9],
        [9, 10],
        [10, 11],
        [11, 12], // ‡∏ô‡∏¥‡πâ‡∏ß‡∏Å‡∏•‡∏≤‡∏á
        [0, 13],
        [13, 14],
        [14, 15],
        [15, 16], // ‡∏ô‡∏¥‡πâ‡∏ß‡∏ô‡∏≤‡∏á
        [0, 17],
        [17, 18],
        [18, 19],
        [19, 20], // ‡∏ô‡∏¥‡πâ‡∏ß‡∏Å‡πâ‡∏≠‡∏¢
        [5, 9],
        [9, 13],
        [13, 17], // ‡∏ù‡πà‡∏≤‡∏°‡∏∑‡∏≠
      ];

      function onResults(results) {
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î canvas ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
        canvasElement.width = videoElement.videoWidth;
        canvasElement.height = videoElement.videoHeight;

        // ‡∏•‡πâ‡∏≤‡∏á canvas
        canvasCtx.save();
        canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);

        if (
          results.multiHandLandmarks &&
          results.multiHandLandmarks.length > 0
        ) {
          statusElement.textContent = `‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏°‡∏∑‡∏≠ ${results.multiHandLandmarks.length} ‡∏°‡∏∑‡∏≠`;
          statusElement.className = "status active";

          results.multiHandLandmarks.forEach((landmarks, index) => {
            // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏°‡∏∑‡∏≠‡∏ã‡πâ‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏ß‡∏≤
            const handedness = results.multiHandedness[index].label;
            const isRight = handedness === "Right";
            const mainColor = isRight ? "#00ff00" : "#ff00ff";
            const lightColor = isRight ? "#88ff88" : "#ff88ff";

            // ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
            drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, {
              color: mainColor,
              lineWidth: 3,
            });

            // ‡∏ß‡∏≤‡∏î‡∏à‡∏∏‡∏î landmarks
            drawLandmarks(canvasCtx, landmarks, {
              color: lightColor,
              lineColor: mainColor,
              radius: 5,
            });

            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏∑‡∏≠‡∏ã‡πâ‡∏≤‡∏¢/‡∏Ç‡∏ß‡∏≤
            const wrist = landmarks[0];
            canvasCtx.fillStyle = mainColor;
            canvasCtx.font = "bold 20px Arial";
            canvasCtx.fillText(
              isRight ? "‡∏°‡∏∑‡∏≠‡∏Ç‡∏ß‡∏≤" : "‡∏°‡∏∑‡∏≠‡∏ã‡πâ‡∏≤‡∏¢",
              wrist.x * canvasElement.width,
              wrist.y * canvasElement.height - 20
            );
          });
        } else {
          statusElement.textContent = "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏°‡∏∑‡∏≠ - ‡∏¢‡∏Å‡∏°‡∏∑‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á";
          statusElement.className = "status inactive";
        }

        canvasCtx.restore();
      }

      // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á
      const camera = new Camera(videoElement, {
        onFrame: async () => {
          await hands.send({ image: videoElement });
        },
        width: 640,
        height: 480,
      });

      camera
        .start()
        .then(() => {
          statusElement.textContent = "üé• ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô - ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏°‡∏∑‡∏≠";
          statusElement.className = "status";
        })
        .catch((error) => {
          statusElement.textContent = "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ";
          statusElement.className = "status inactive";
          console.error("Error accessing camera:", error);
        });
    </script>
  </body>
</html>
